(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"0226":function(t,e,i){t.exports=i.p+"img/mazefailed.4018df00.webp"},"0f7e":function(t,e,i){t.exports=i.p+"img/props6.34eb2c16.webp"},"1e7b":function(t,e,i){t.exports=i.p+"img/props3.d6b0983c.webp"},6190:function(t,e,i){t.exports=i.p+"img/props4.997bbcff.webp"},"8cf4":function(t,e,i){},a6f6:function(t,e,i){"use strict";i("8cf4")},b4b7:function(t,e,i){t.exports=i.p+"img/props2.4679df21.webp"},b962:function(t,e,i){t.exports=i.p+"img/props1.e3266f30.webp"},d241:function(t,e,i){t.exports=i.p+"img/props5.e88e18b9.webp"},e7ab:function(t,e,i){t.exports=i.p+"img/mazesuccess.d9fc5950.webp"},fe2b:function(t,e,i){"use strict";i.r(e),i("caad"),i("2532");var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mazeWrap"},[e("div",{staticClass:"passDev",on:{mouseup:function(e){return"button"in e&&1!==e.button?null:t.setResult.apply(null,arguments)}}}),e("div",{attrs:{id:"center"}},[e("div",{ref:"stage",attrs:{id:"stage"}},[e("div",{staticClass:"q-mx-xs",attrs:{id:"game"}},[e("div",{ref:"maze",attrs:{id:"maze"}},[t._m(0)])]),e("div",{staticClass:"row q-mt-md"},[e("q-space"),t._l(t.colorSlots,function(i){return e("div",{key:i.key,staticClass:"col-2 flex flex-center"},[t.Game.eatenLog.includes(i.key)?e("div",{staticClass:"emptyPropsItem"}):e("div",{staticClass:"propsItem",class:i.key},[e("q-img",{staticClass:"propsImg",class:i.key,attrs:{src:i.src}})],1)])}),e("q-space")],2),e("q-card",{staticClass:"q-mt-md",staticStyle:{"max-width":"360px"},attrs:{flat:"",bordered:""}},[e("q-card-section",{attrs:{horizontal:""}},[e("q-card-section",{staticClass:"full-width q-pa-sm q-pr-xs"},[e("q-scroll-area",{ref:"scrollArea",staticClass:"msgContentText",attrs:{"content-style":t.intorAreaSty}},[e("div",t._l(t.stateMsg,function(i){return e("div",{key:i,domProps:{innerHTML:t._s(i)}})}),0)])],1),e("q-separator",{attrs:{vertical:""}}),e("q-card-section",{staticClass:"q-pa-none q-ma-xs"},[e("div",{staticClass:"fit flex flex-center"},[t.isGameRuning?e("q-btn",{staticStyle:{width:"90px"},attrs:{ripple:!1,flat:"",color:"blue-10"},on:{click:t.startGame}},[e("q-icon",{attrs:{name:"loop",size:"md"}}),e("div",[t._v("重新開始")])],1):e("q-btn",{staticStyle:{width:"90px"},attrs:{ripple:!1,flat:"",color:"blue-10"},on:{click:t.enableMotion}},[e("q-icon",{attrs:{name:"sports_esports",size:"md"}}),e("div",[t._v("開始任務")])],1)],1)])],1)],1),e("div",{directives:[{name:"show",rawName:"v-show",value:(!t.motionSupported||t.motionDenied)&&!t.motionEnabled,expression:"(!motionSupported || motionDenied) && !motionEnabled"}],staticClass:"joystickWrap"},[e("div",{attrs:{id:"joystick"}},[e("div",{staticClass:"joystick-arrow"}),e("div",{staticClass:"joystick-arrow"}),e("div",{staticClass:"joystick-arrow"}),e("div",{staticClass:"joystick-arrow"}),e("div",{ref:"joystickHead",attrs:{id:"joystick-head"}})])])],1)]),e("q-dialog",{attrs:{persistent:""},model:{value:t.isOpenAlertModel,callback:function(e){t.isOpenAlertModel=e},expression:"isOpenAlertModel"}},[e("q-card",{staticStyle:{width:"300px","max-width":"90vw"}},[e("q-toolbar",{staticClass:"bg-blue-grey-10 text-white"},[e("q-toolbar-title",[1==t.alertState?e("span",[t._v("任務成功")]):t._e(),2==t.alertState?e("span",[t._v("任務失敗")]):t._e()])],1),e("q-separator"),1==t.alertState?e("q-card-section",{staticClass:"text-h8"},[e("div",{staticClass:"q-mb-sm resImg"},[e("q-img",{attrs:{src:i("e7ab")}})],1),e("p",[t._v("當你將道具球送達鳥居時，靈獸們原本暴躁的氣息逐漸平息。")]),e("p",{staticClass:"q-mb-lg"},[t._v("牠們接過道具，緩緩轉身回到鳥居兩側，各自坐鎮如初。")]),e("p",[t._v("✅ 現在你可以通過鳥居了！")])]):t._e(),2==t.alertState?e("q-card-section",{staticClass:"text-h8"},[e("div",{staticClass:"q-mb-sm resImg"},[e("q-img",{attrs:{src:i("0226")}})],1),e("p",[t._v("\n          靈獸們盯著你手中的道具，眼神變得更加狂亂，嘶吼聲震動整座森林，連空氣都為之凝結...\n        ")]),e("p",{staticClass:"q-mt-md"},[t._v("這不是牠們的東西，你搞錯了...")])]):t._e(),e("q-separator"),e("q-card-actions",{attrs:{align:"right"}},[1==t.alertState?e("q-btn",{staticClass:"full-width",attrs:{unelevated:"",icon:"touch_app",label:"確認",color:"blue-grey-9"},on:{click:function(e){return t.closeAlertModel(1)}}}):t._e(),2==t.alertState?e("q-btn",{staticClass:"full-width",attrs:{unelevated:"",icon:"touch_app",label:"再次挑戰",color:"blue-grey-9"},on:{click:function(e){return t.closeAlertModel(2)}}}):t._e()],1)],1)],1)],1)},n=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"torii-group"},[e("div",{staticClass:"torii"},[e("div",{staticClass:"red-two"}),e("div",{staticClass:"pillar"}),e("div",{staticClass:"pillar left"})]),e("div",{staticClass:"stair"},[e("div",{staticClass:"step step-1"}),e("div",{staticClass:"step step-2"}),e("div",{staticClass:"step step-3"})])])}],a=i("7ec2"),s=i.n(a),l=i("c973"),r=i.n(l),c=(i("d9e2"),i("99af"),i("4de4"),i("7db0"),i("e260"),i("d81d"),i("14d9"),i("a434"),i("4057"),i("2af1"),i("b680"),i("cca6"),i("d3b7"),i("6062"),i("3ca3"),i("88e6"),i("70cc"),i("eb03"),i("22e5"),i("c01e"),i("fa76"),i("8306"),i("159b"),i("ddb0"),{name:"maze",data:function(){var t=25,e=10,o=16,n=18,a=1.5,s=3.2,l=.008,r={level1:{meta:{cols:10,rows:9},balls:[{column:0,row:0},{column:5,row:0},{column:9,row:0},{column:0,row:8},{column:4,row:8},{column:9,row:8}],walls:[{column:0,row:0,horizontal:!0,length:10},{column:0,row:0,horizontal:!1,length:9},{column:0,row:9,horizontal:!0,length:10},{column:10,row:0,horizontal:!1,length:9},{column:0,row:6,horizontal:!0,length:1},{column:0,row:8,horizontal:!0,length:1},{column:1,row:1,horizontal:!0,length:2},{column:1,row:7,horizontal:!0,length:1},{column:3,row:2,horizontal:!0,length:1},{column:3,row:4,horizontal:!0,length:1.1},{column:2,row:6,horizontal:!0,length:1},{column:3,row:8,horizontal:!0,length:3},{column:4,row:6,horizontal:!0,length:1},{column:4,row:1,horizontal:!0,length:1},{column:4,row:2,horizontal:!0,length:1},{column:5.9,row:4,horizontal:!0,length:1.1},{column:5,row:2,horizontal:!0,length:2},{column:5,row:7,horizontal:!0,length:1},{column:6,row:1,horizontal:!0,length:1},{column:6,row:6,horizontal:!0,length:2},{column:7,row:3,horizontal:!0,length:2},{column:7,row:7,horizontal:!0,length:2},{column:8,row:1,horizontal:!0,length:1},{column:8,row:2,horizontal:!0,length:1},{column:8,row:3,horizontal:!0,length:1},{column:8,row:4,horizontal:!0,length:2},{column:8,row:8,horizontal:!0,length:2},{column:1,row:1,horizontal:!1,length:2},{column:1,row:4,horizontal:!1,length:2},{column:2,row:2,horizontal:!1,length:2},{column:2,row:5,horizontal:!1,length:1},{column:2,row:7,horizontal:!1,length:2},{column:3,row:0,horizontal:!1,length:1},{column:3,row:2,horizontal:!1,length:3},{column:3,row:6,horizontal:!1,length:2},{column:4,row:6,horizontal:!1,length:1},{column:5,row:1,horizontal:!1,length:1},{column:6,row:0,horizontal:!1,length:1},{column:5,row:6,horizontal:!1,length:1},{column:5,row:8,horizontal:!1,length:1},{column:6,row:6,horizontal:!1,length:1},{column:7,row:2,horizontal:!1,length:3},{column:7,row:7,horizontal:!1,length:2},{column:8,row:2,horizontal:!1,length:1},{column:8,row:4,horizontal:!1,length:2},{column:9,row:1,horizontal:!1,length:1},{column:9,row:5,horizontal:!1,length:2},{column:4.58,row:3.3,horizontal:!0,length:.88,invisible:!0},{column:4.58,row:3.3,horizontal:!1,length:.9,invisible:!0},{column:5.45,row:3.3,horizontal:!1,length:.9,invisible:!0}],holes:[{column:0,row:5},{column:2,row:0},{column:2,row:3},{column:4,row:6},{column:6,row:4},{column:6,row:8},{column:8,row:1},{column:8,row:2}],center:{x:175.5,y:127.5,radius:12},requiredColors:["blue","golden","orange"]}},c=function(t,e){return Math.max(-e,Math.min(e,t))},h=function(t,e){return Math.max(Math.min(t,e),-e)},m=function(t,e){return Math.hypot(e.x-t.x,e.y-t.y)},u=function(t,e){var i=Math.atan((e.y-t.y)/(e.x-t.x));return e.x-t.x<0&&(i+=Math.PI),i},d=function(t,e){return Math.abs(t)<=e?0:t>e?t-e:t+e};return{pathW:t,wallW:e,ballSize:o,holeSize:n,maxVelocity:a,GRAVITY:s,FRICTION_COEFF:l,MAPS:r,clamp:c,minmax:h,distance2D:m,getAngle:u,slow:d,mazeEl:null,joystickHeadEl:null,stageEl:null,endEl:null,motionSupported:"undefined"!==typeof window&&"undefined"!==typeof window.DeviceOrientationEvent,motionEnabled:!1,motionDenied:!1,motionHandler:null,listeners:[],Game:{hardMode:!1,inProgress:!1,previousTimestamp:void 0,accelerationX:0,accelerationY:0,frictionX:0,frictionY:0,mouseStartX:0,mouseStartY:0,currentMapKey:"level1",map:null,walls:[],holes:[],balls:[],ballEls:[],holeEls:[],eatenLog:[]},rafId:0,isOpenAlertModel:!1,alertState:null,isGameRuning:!1,stateMsg:["<div>將正確的道具球，同時送達鳥居處。</div>"],colorSlots:[{key:"red",src:i("b962")},{key:"golden",src:i("b4b7")},{key:"green",src:i("1e7b")},{key:"blue",src:i("6190")},{key:"purple",src:i("d241")},{key:"orange",src:i("0f7e")}],intorAreaSty:{display:"flex",justifyContent:"start",alignItems:"center"}}},computed:{},methods:{setResult:function(){var t={type:"customAns"};parent.postMessage(t,location.origin)},openAlertModel:function(t){this.isOpenAlertModel=!0,this.alertState=t},closeAlertModel:function(t){1==t&&this.setResult(),2==t&&(this.isGameRuning=!1,this.stopMotion(),this.resetGame(),this.isOpenAlertModel=!1)},startGame:function(){this.isGameRuning=!1,this.stopMotion(),this.resetGame()},gridToPixels:function(t,e){return{x:t*(this.pathW+this.wallW)+(this.wallW/2+this.pathW/2),y:e*(this.pathW+this.wallW)+(this.wallW/2+this.pathW/2)}},wallsToPixels:function(t){var e=this;return t.map(function(t){return{x:t.column*(e.pathW+e.wallW),y:t.row*(e.pathW+e.wallW),horizontal:t.horizontal,length:t.length*(e.pathW+e.wallW),invisible:!!t.invisible}})},holesToPixels:function(t){var e=this;return t.map(function(t){var i=t.column,o=t.row;return e.gridToPixels(i,o)})},ballsToPixels:function(t){var e=this;return t.map(function(t){var i=t.column,o=t.row,n=e.gridToPixels(i,o);return{x:n.x,y:n.y,velocityX:0,velocityY:0}})},clearMazeDOM:function(){this.mazeEl.querySelectorAll(".wall").forEach(function(t){return t.remove()}),this.Game.holeEls.forEach(function(t){return t.remove()}),this.Game.holeEls=[]},drawWalls:function(t){var e=this;t.forEach(function(t){var i=t.x,o=t.y,n=t.horizontal,a=t.length,s=t.invisible,l=document.createElement("div");l.className="wall",s&&l.classList.add("invisible-wall"),l.style.cssText="left:".concat(i,"px; top:").concat(o,"px; width:").concat(e.wallW,"px; height:").concat(a,"px; transform: rotate(").concat(n?-90:0,"deg);"),e.mazeEl.appendChild(l)})},initBalls:function(t){var e=this,i=["red","golden","green","blue","purple","orange"];this.Game.ballEls.length!==t.length&&(this.Game.ballEls.forEach(function(t){return t&&t.remove()}),this.Game.ballEls=[]),t.forEach(function(t,o){var n=t.x,a=t.y,s=e.Game.ballEls[o],l=i[o%i.length];s||(s=document.createElement("div"),s.className="ball ".concat(l),e.mazeEl.appendChild(s),e.Game.ballEls[o]=s),s.style.cssText="left:".concat(n,"px; top:").concat(a,"px;")})},drawHoles:function(t){var e=this;this.Game.hardMode&&t.forEach(function(t){var i=t.x,o=t.y,n=document.createElement("div");n.className="black-hole",n.style.cssText="left:".concat(i,"px; top:").concat(o,"px;"),e.mazeEl.appendChild(n),e.Game.holeEls.push(n)})},updateCenterVisual:function(){var t,e=null===(t=this.Game.map)||void 0===t?void 0:t.center;if(e&&this.endEl){var i=2*e.radius;this.endEl.style.setProperty("--center-diam","".concat(i,"px")),this.endEl.style.left="".concat(e.x,"px"),this.endEl.style.top="".concat(e.y,"px"),this.endEl.style.display="block"}},eatBall:function(t,e){var i,o,n,a=this,s=this.Game.ballEls[t],l=s?this.getBallColor(s):"unknown",r=this.Game.balls[t],c=null!==(i=null===r||void 0===r?void 0:r.x)&&void 0!==i?i:0,h=null!==(o=null===r||void 0===r?void 0:r.y)&&void 0!==o?o:0;switch(this.Game.eatenLog.push(l),console.log("[EATEN] #".concat(t," ").concat(l," by hole#").concat(e," at (").concat(c.toFixed(1),",").concat(h.toFixed(1),")")),l){case"red":n='<div>啊啊啊，<span style="color: #e74c3c">紅色</span> 道具球被搶走了！</div>';break;case"golden":n='<div> 糟糕，<span style="color: #f39c12">金色</span> 道具球被搶走了！</div>';break;case"green":n='<div> 可惡啊，<span style="color: #329928">綠色</span> 道具球被搶走了！</div>';break;case"blue":n='<div> 嗚哇，<span style="color: #9dd1f3">藍色</span> 道具球被搶走了！</div>';break;case"purple":n='<div> 哎呀，<span style="color: #9b59b6">紫色</span> 道具球被搶走了！</div>';break;case"orange":n='<div> 討厭啦，<span style="color: #f1c40f">橘色</span> 道具球被搶走了！</div>';break;default:break}this.stateMsg.push(n),setTimeout(function(){a.$refs.scrollArea.setScrollPosition("vertical",300)},100),this.showBeastEmote(e,"happy"),s&&s.parentNode&&s.parentNode.removeChild(s),this.Game.ballEls.splice(t,1),this.Game.balls.splice(t,1)},showBeastEmote:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"happy",o=null===(e=this.Game.holeEls)||void 0===e?void 0:e[t];if(o){var n=document.createElement("div");n.className="emote emote-".concat(i),n.innerHTML='<i class="mouth"></i>',o.appendChild(n),setTimeout(function(){n&&n.parentNode&&n.parentNode.removeChild(n)},3400)}},getBallColor:function(t){var e=["green","blue","orange","red","purple","golden"];return e.find(function(e){return t.classList.contains(e)})||"unknown"},isVictory:function(t,e){var i=new Set(t);return i.size===e.length&&e.every(function(t){return i.has(t)})},evaluateCenterResult:function(t,e,i,o){var n=this,a=t.map(function(t,o){return{in:n.distance2D(t,i)<i.radius,color:n.getBallColor(e[o])}}).filter(function(t){return t.in}).map(function(t){return t.color});return 0===a.length?{status:"none"}:this.isVictory(a,o)?{status:"win"}:{status:"fail"}},applyFrictionAndAcceleration:function(t,e,i,o,n){0===e?t.velocityX=this.slow(t.velocityX,o):(t.velocityX+=e,t.velocityX=this.minmax(t.velocityX-Math.sign(e)*o,this.maxVelocity)),0===i?t.velocityY=this.slow(t.velocityY,n):(t.velocityY+=i,t.velocityY=this.minmax(t.velocityY-Math.sign(i)*n,this.maxVelocity))},precomputeNext:function(t){t.nextX=t.x+t.velocityX,t.nextY=t.y+t.velocityY},closestItCanBe:function(t,e){var i=this.getAngle(t,e),o=Math.cos(i)*(this.wallW/2+this.ballSize/2),n=Math.sin(i)*(this.wallW/2+this.ballSize/2);return{x:t.x+o,y:t.y+n}},rollAroundCap:function(t,e){var i=this.getAngle(e,t),o=this.getAngle({x:0,y:0},{x:e.velocityX,y:e.velocityY}),n=i-o,a=this.distance2D({x:0,y:0},{x:e.velocityX,y:e.velocityY}),s=Math.sin(n)*a,l=this.wallW/2+this.ballSize/2,r=Math.atan(s/l),c={x:Math.cos(i+Math.PI-r)*l,y:Math.sin(i+Math.PI-r)*l},h=e.x,m=e.y,u=e.x-(t.x+c.x),d=e.y-(t.y+c.y),p=h+u,v=m+d;return{x:h,y:m,velocityX:u,velocityY:d,nextX:p,nextY:v}},collideWithWalls:function(t,e){var i=this;e.forEach(function(e){if(e.horizontal){if(t.nextY+i.ballSize/2>=e.y-i.wallW/2&&t.nextY-i.ballSize/2<=e.y+i.wallW/2){var o={x:e.x,y:e.y},n={x:e.x+e.length,y:e.y};if(t.nextX+i.ballSize/2>=o.x-i.wallW/2&&t.nextX<o.x){var a=i.distance2D(o,{x:t.nextX,y:t.nextY});if(a<i.ballSize/2+i.wallW/2){var s=i.closestItCanBe(o,{x:t.nextX,y:t.nextY});Object.assign(t,i.rollAroundCap(o,{x:s.x,y:s.y,velocityX:t.velocityX,velocityY:t.velocityY}))}}if(t.nextX-i.ballSize/2<=n.x+i.wallW/2&&t.nextX>n.x){var l=i.distance2D(n,{x:t.nextX,y:t.nextY});if(l<i.ballSize/2+i.wallW/2){var r=i.closestItCanBe(n,{x:t.nextX,y:t.nextY});Object.assign(t,i.rollAroundCap(n,{x:r.x,y:r.y,velocityX:t.velocityX,velocityY:t.velocityY}))}}t.nextX>=o.x&&t.nextX<=n.x&&(t.nextY=t.nextY<e.y?e.y-i.wallW/2-i.ballSize/2:e.y+i.wallW/2+i.ballSize/2,t.y=t.nextY,t.velocityY=-t.velocityY/3)}}else if(t.nextX+i.ballSize/2>=e.x-i.wallW/2&&t.nextX-i.ballSize/2<=e.x+i.wallW/2){var c={x:e.x,y:e.y},h={x:e.x,y:e.y+e.length};if(t.nextY+i.ballSize/2>=c.y-i.wallW/2&&t.nextY<c.y){var m=i.distance2D(c,{x:t.nextX,y:t.nextY});if(m<i.ballSize/2+i.wallW/2){var u=i.closestItCanBe(c,{x:t.nextX,y:t.nextY});Object.assign(t,i.rollAroundCap(c,{x:u.x,y:u.y,velocityX:t.velocityX,velocityY:t.velocityY}))}}if(t.nextY-i.ballSize/2<=h.y+i.wallW/2&&t.nextY>h.y){var d=i.distance2D(h,{x:t.nextX,y:t.nextY});if(d<i.ballSize/2+i.wallW/2){var p=i.closestItCanBe(h,{x:t.nextX,y:t.nextY});Object.assign(t,i.rollAroundCap(h,{x:p.x,y:p.y,velocityX:t.velocityX,velocityY:t.velocityY}))}}t.nextY>=c.y&&t.nextY<=h.y&&(t.nextX=t.nextX<e.x?e.x-i.wallW/2-i.ballSize/2:e.x+i.wallW/2+i.ballSize/2,t.x=t.nextX,t.velocityX=-t.velocityX/3)}})},checkBlackHoles:function(t,e){if(!this.Game.hardMode)return-1;for(var i=0;i<e.length;i++)if(this.distance2D(e[i],{x:t.nextX,y:t.nextY})<=this.holeSize/2)return i;return-1},commitBallMovement:function(t){t.x+=t.velocityX,t.y+=t.velocityY},resetPhysics:function(){this.Game.previousTimestamp=void 0,this.Game.inProgress=!1,this.Game.accelerationX=0,this.Game.accelerationY=0,this.Game.frictionX=0,this.Game.frictionY=0},loadMap:function(t){if(this.Game.currentMapKey=t,this.Game.map=this.MAPS[t],!this.Game.map)throw new Error("Map not found: ".concat(t));this.Game.walls=this.wallsToPixels(this.Game.map.walls),this.Game.holes=this.holesToPixels(this.Game.map.holes),this.Game.balls=this.ballsToPixels(this.Game.map.balls),this.clearMazeDOM(),this.drawWalls(this.Game.walls),this.initBalls(this.Game.balls),this.drawHoles(this.Game.holes),this.updateCenterVisual()},resetGame:function(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=0),this.stateMsg=["<div>將正確的道具球，同時送達鳥居處。</div>"],this.resetPhysics(),this.loadMap(this.Game.currentMapKey),this.Game.eatenLog=[],this.joystickHeadEl&&(this.joystickHeadEl.style.cssText="left:0; top:0; animation:glow .6s infinite alternate ease-in-out 4s; cursor:grab;")},startLoop:function(){this.Game.inProgress||(this.Game.inProgress=!0,this.rafId=window.requestAnimationFrame(this.mainLoop))},mainLoop:function(t){var e=this;if(this.Game.inProgress){if(void 0===this.Game.previousTimestamp)return this.Game.previousTimestamp=t,void(this.rafId=window.requestAnimationFrame(this.mainLoop));var i=(t-this.Game.previousTimestamp)/16,o=Math.min(i,1.6);try{for(var n=this.Game.accelerationX*o,a=this.Game.accelerationY*o,s=this.Game.frictionX*o,l=this.Game.frictionY*o,r=0;r<this.Game.balls.length;r++){var c=this.Game.balls[r];this.applyFrictionAndAcceleration(c,n,a,s,l),this.precomputeNext(c),this.collideWithWalls(c,this.Game.walls);var h=this.checkBlackHoles(c,this.Game.holes);-1===h?this.commitBallMovement(c):(this.eatBall(r,h),r--)}if(this.Game.balls.forEach(function(t,i){var o=t.x,n=t.y;e.Game.ballEls[i]&&(e.Game.ballEls[i].style.cssText="left:".concat(o,"px; top:").concat(n,"px;"))}),0===this.Game.balls.length)return this.stateMsg.push("完蛋，道具球全被搶走了，任務失敗。"),void(this.Game.inProgress=!1);var m=this.evaluateCenterResult(this.Game.balls,this.Game.ballEls,this.Game.map.center,this.Game.map.requiredColors);if("win"===m.status)return this.stopMotion(),this.openAlertModel(1),void(this.Game.inProgress=!1);if("fail"===m.status)return this.stopMotion(),this.openAlertModel(2),void(this.Game.inProgress=!1);this.Game.previousTimestamp=t,this.rafId=window.requestAnimationFrame(this.mainLoop)}catch(u){console.error(u),this.Game.inProgress=!1}}},onMouseMove:function(t){if(this.Game.inProgress&&this.joystickHeadEl){var e=-this.minmax(this.Game.mouseStartX-t.clientX,10),i=-this.minmax(this.Game.mouseStartY-t.clientY,10);this.joystickHeadEl.style.cssText="left:".concat(e,"px; top:").concat(i,"px; animation:none; cursor:grabbing;");var o=1.2*e,n=1.2*i;this.Game.accelerationX=this.GRAVITY*Math.sin(o/180*Math.PI),this.Game.accelerationY=this.GRAVITY*Math.sin(n/180*Math.PI),this.Game.frictionX=this.GRAVITY*Math.cos(o/180*Math.PI)*this.FRICTION_COEFF,this.Game.frictionY=this.GRAVITY*Math.cos(n/180*Math.PI)*this.FRICTION_COEFF}},onTouchMove:function(t){if(this.Game.inProgress){var e=t.touches[0],i=-this.minmax(this.Game.mouseStartX-e.clientX,10),o=-this.minmax(this.Game.mouseStartY-e.clientY,10);this.joystickHeadEl.style.cssText="left:".concat(i,"px; top:").concat(o,"px; animation:none; cursor:grabbing;");var n=1.2*i,a=1.2*o;this.Game.accelerationX=this.GRAVITY*Math.sin(n/180*Math.PI),this.Game.accelerationY=this.GRAVITY*Math.sin(a/180*Math.PI),this.Game.frictionX=this.GRAVITY*Math.cos(n/180*Math.PI)*this.FRICTION_COEFF,this.Game.frictionY=this.GRAVITY*Math.cos(a/180*Math.PI)*this.FRICTION_COEFF,t.preventDefault()}},onKeyDown:function(t){[" ","H","h","E","e"].includes(t.key)&&(t.preventDefault()," "===t.key?this.resetGame():"H"===t.key||"h"===t.key?(this.Game.hardMode=!0,this.resetGame()):"E"!==t.key&&"e"!==t.key||(this.Game.hardMode=!1,this.resetGame()))},bindPointer:function(){var t=this,e=function(e){t.Game.inProgress||(t.Game.mouseStartX=e.clientX,t.Game.mouseStartY=e.clientY,t.startLoop(),t.joystickHeadEl.style.cssText="animation:none; cursor:grabbing;")};this.joystickHeadEl.addEventListener("mousedown",e),this.listeners.push({target:this.joystickHeadEl,type:"mousedown",fn:e});var i=function(e){var i=e.touches[0];t.Game.inProgress||(t.Game.mouseStartX=i.clientX,t.Game.mouseStartY=i.clientY,t.startLoop(),t.joystickHeadEl.style.cssText="animation:none; cursor:grabbing;",e.preventDefault())};this.joystickHeadEl.addEventListener("touchstart",i,{passive:!1}),this.listeners.push({target:this.joystickHeadEl,type:"touchstart",fn:i,opts:{passive:!1}}),window.addEventListener("mousemove",this.onMouseMove),this.listeners.push({target:window,type:"mousemove",fn:this.onMouseMove}),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.listeners.push({target:window,type:"touchmove",fn:this.onTouchMove,opts:{passive:!1}}),window.addEventListener("keydown",this.onKeyDown),this.listeners.push({target:window,type:"keydown",fn:this.onKeyDown})},applyPhysicsFromRotation:function(t,e){var i=.8,o=this.clamp(e/i,15),n=this.clamp(t/i,15);this.Game.accelerationX=this.GRAVITY*Math.sin(e/180*Math.PI),this.Game.accelerationY=this.GRAVITY*Math.sin(t/180*Math.PI),this.Game.frictionX=this.GRAVITY*Math.cos(e/180*Math.PI)*this.FRICTION_COEFF,this.Game.frictionY=this.GRAVITY*Math.cos(t/180*Math.PI)*this.FRICTION_COEFF,this.joystickHeadEl.style.cssText="left:".concat(o,"px; top:").concat(n,"px; animation:none; cursor:grabbing;")},mapTiltAxis:function(t,e,i,o){var n=Math.max(-e,Math.min(e,t)),a=Math.sign(n),s=Math.abs(n)/e,l=Math.pow(s,o);return a*l*i},enableMotion:function(){var t=this;return r()(s()().mark(function e(){var i;return s()().wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.Game.hardMode=!0,t.isGameRuning=!0,e.prev=2,t.motionSupported){e.next=9;break}return t.motionDenied=!0,t.stopMotion(),t.resetGame(),console.log("此裝置不支援體感控制。"),e.abrupt("return");case 9:if("undefined"===typeof DeviceOrientationEvent||"function"!==typeof DeviceOrientationEvent.requestPermission){e.next=19;break}return e.next=12,DeviceOrientationEvent.requestPermission();case 12:if(i=e.sent,"granted"===i){e.next=19;break}return t.motionDenied=!0,t.stopMotion(),t.resetGame(),console.log("權限未授予，無法啟用體感控制。"),e.abrupt("return");case 19:t.motionDenied=!1,t.stopMotion(),t.resetGame(),t.startMotion(),t.motionEnabled=!0,e.next=31;break;case 26:e.prev=26,e.t0=e["catch"](2),console.warn("啟用體感操作失敗",e.t0),t.motionDenied=!0,t.stopMotion();case 31:case"end":return e.stop()}},e,null,[[2,26]])}))()},startMotion:function(){var t=this;if(!this.motionHandler){var e=15,i=15,o=32,n=24,a=.48,s=.55,l=1,r=1,c=0,h=0;this.motionHandler=function(m){var u,d;t.Game.inProgress||t.startLoop();var p=null!==(u=m.gamma)&&void 0!==u?u:0,v=null!==(d=m.beta)&&void 0!==d?d:0,f=p-h,y=v-c,w=r*t.mapTiltAxis(f,i,n,s),x=l*t.mapTiltAxis(y,e,o,a);t.applyPhysicsFromRotation(x,w)},window.addEventListener("deviceorientation",this.motionHandler,{passive:!0}),this.listeners.push({target:window,type:"deviceorientation",fn:this.motionHandler,opts:{passive:!0}})}},stopMotion:function(){this.motionHandler&&(window.removeEventListener("deviceorientation",this.motionHandler),this.motionHandler=null),this.motionEnabled=!1},responsiveScale:function(){var t=this.stageEl;if(t){var e=function(){t.style.setProperty("--scale",1);var e=t.getBoundingClientRect();return{w:e.width,h:e.height}},i=e(),o=function(){var e=window.innerWidth,o=window.innerHeight,n=12,a=Math.min(1,(e-n)/i.w,(o-n)/i.h);t.style.setProperty("--scale",a)},n=function(){i=e(),o()};o();var a=o,s=function(){return setTimeout(n,250)};window.addEventListener("resize",a),window.addEventListener("orientationchange",s),this.listeners.push({target:window,type:"resize",fn:a}),this.listeners.push({target:window,type:"orientationchange",fn:s})}}},mounted:function(){this.mazeEl=this.$refs.maze,this.joystickHeadEl=this.$refs.joystickHead,this.stageEl=this.$refs.stage,this.endEl=this.$refs.end,this.Game.hardMode=!0,this.isGameRuning=!1,this.resetGame(),this.bindPointer(),this.responsiveScale(),this.mainLoop=this.mainLoop.bind(this)},beforeUnmount:function(){this.rafId&&cancelAnimationFrame(this.rafId),this.stopMotion(),this.listeners.forEach(function(t){var e=t.target,i=t.type,o=t.fn,n=t.opts;try{e.removeEventListener(i,o,n)}catch(a){}}),this.listeners=[]}}),h=c,m=(i("a6f6"),i("2877")),u=i("2c91"),d=i("068f"),p=i("f09f"),v=i("a370"),f=i("4983"),y=i("eb85"),w=i("9c40"),x=i("0016"),g=i("24e8"),b=i("65c6"),G=i("6ac5"),M=i("4b7e"),z=i("eebe"),E=i.n(z),C=Object(m["a"])(h,o,n,!1,null,"716fcedd",null);e["default"]=C.exports,E()(C,"components",{QSpace:u["a"],QImg:d["a"],QCard:p["a"],QCardSection:v["a"],QScrollArea:f["a"],QSeparator:y["a"],QBtn:w["a"],QIcon:x["a"],QDialog:g["a"],QToolbar:b["a"],QToolbarTitle:G["a"],QCardActions:M["a"]})}}]);